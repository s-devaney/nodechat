<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<title>Nodechat v0.2.1</title>
	<link rel="stylesheet" type="text/css" media="screen" href="css/style.css" />
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
	<script type="text/javascript">
		var socket = io.connect("http://192.168.1.67:8080");
		
		socket.on("connect", function() {
			//TODO: NOT USER FRIENDLY!
			socket.emit("adduser", prompt());
		});
		
		//TODO: FIX NONDESCRIPT PARAMETER NAMES
		socket.on("updatechat", function(username, data) {
			console.log("received message: "+data);
			//TODO: USERNAME STYLING
			$("#messages").append("<p>"+username+": "+data+"</p>");
		});
		
		//TODO: FIX NONDESCRIPT PARAMETER NAMES
		socket.on("updateusers", function(data) {
			console.log(data);
			//TODO: THIS IS NOT EFFICIENT!
			$("#usernames").empty();
			
			$.each(data, function(index, value) {
				$("#usernames").append("<p>"+value.username+"</p>");
			});
		});
		
		$(document).ready(function() {
			$("#input").keypress(function(e) {
				if(e.which == 13) {
					var message = $(this).val();
					console.log("send message: " + message);
					socket.emit("sendchat", $(this).val());
					$(this).val("");
				}
			});
			
			//offset height of messagesContainer+usernameContainer div by 40px to accomodate for text input box
			var parent = $("#chatContainer").height();
			$("#messagesContainer, #usernames").height((parent-40)/parent*100+"%");
		});
		
	</script>
</head>
<body>
	<div id="container">
		<div id="chatContainer">
			<div id="messagesContainer">
				<div id="messages">
				</div>
			</div>
			<div id="inputContainer">
				<input type="text" id="input" class="center" maxlength="240"/>
			</div>
		</div>
		<div id="usernamesContainer">
			<div id="usernames">
			</div>
			<div id="version">
				<p>Nodechat v0.2.1 <a href="http://devaney.me.uk">Sam Devaney</a></p>
			</div>
		</div>
	</div>
</body>
</html>